openapi: 3.1.0
info:
  title: Obsidian Vault Assistant
  description: |
    Access and interact with your Obsidian vault through ChatGPT.
    This plugin enables natural language querying of your personal knowledge base.
  version: 1.0.0
servers:
  - url: https://closer-ma-besides-ted.trycloudflare.com
    description: Development server
paths:
  /query:
    get:
      operationId: queryVault
      summary: Query your Obsidian vault
      description: |
        Search your Obsidian vault using natural language queries.
        Results can be filtered by tags or date ranges.
        The response includes a synthesized answer and the source documents.
      parameters:
        - name: q
          in: query
          description: Natural language query
          schema:
            type: string
          required: true
        - name: session_id
          in: query
          description: Optional session ID for conversation continuity
          schema:
            type: string
        - name: tags
          in: query
          description: Optional list of tags to filter by
          schema:
            type: array
            items:
              type: string
        - name: date_range
          in: query
          description: Optional date range filter (e.g. "last_30_days", "last_week", "this_month")
          schema:
            type: string
      responses:
        '200':
          description: Query result with sources
          content:
            application/json:
              schema:
                type: object
                properties:
                  response:
                    type: string
                    description: Synthesized answer with links to source thoughts
                  sources:
                    type: array
                    items:
                      type: object
                      properties:
                        title:
                          type: string
                        excerpt:
                          type: string
                        score:
                          type: number
                          format: float
                  session_id:
                    type: string
                    description: Session ID for this conversation
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  detail:
                    type: string
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  detail:
                    type: string

  /save_conversation:
    post:
      operationId: saveConversation
      summary: Save conversation to the current day's page in Obsidian
      description: |
        Saves the current ChatGPT conversation to the current day's page in your Obsidian vault.
        If the day's page doesn't exist, it will be created first.
        The conversation will be added under a header "## My Obsidian Helper: {conversation name}".
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - session_id
                - conversation_name
              properties:
                session_id:
                  type: string
                  description: Session ID of the current conversation
                conversation_name:
                  type: string
                  description: Name to identify this conversation in the daily note
      responses:
        '200':
          description: Conversation saved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Conversation saved to 2023-07-15.md"
                  file_path:
                    type: string
                    example: "2023-07-15.md"
        '404':
          description: Session or conversation not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  detail:
                    type: string
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  detail:
                    type: string

  /index:
    post:
      operationId: indexVault
      summary: Index the Obsidian vault
      description: |
        Index the Obsidian vault content into the vector store.
        This needs to be called before querying if the index does not exist.
      responses:
        '200':
          description: Indexing result
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  message:
                    type: string
                  document_count:
                    type: integer 